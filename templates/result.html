<!-- result.html ì „ì²´ ìˆ˜ì • -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¬í–‰ ê³„íš ê²°ê³¼ - AI Travel Planner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #e8f4f8 0%, #d0e8f0 100%);
            font-family: 'Noto Sans KR', sans-serif;
        }

        .result-container {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 0;
            min-height: 100vh;
        }

        /* ì™¼ìª½ ì„¹ì…˜ */
        .left-section {
            padding: 40px;
            overflow-y: auto;
            max-height: 100vh;
        }

        /* ì˜¤ë¥¸ìª½ ì§€ë„ */
        .right-section {
            position: sticky;
            top: 0;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 15px rgba(0,0,0,0.1);
        }

        .map-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .marker-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .day1 { background: #e74c3c; }
        .day2 { background: #3498db; }
        .day3 { background: #2ecc71; }

        .result-header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
            color: white;
        }

        .result-header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .result-header p {
            color: rgba(255,255,255,0.95);
            font-size: 1.1rem;
            margin: 5px 0;
            line-height: 1.6;  /* ì¤„ ê°„ê²© */
        }

        .back-btn {
            display: inline-block;
            background: white;
            color: #3498db;
            padding: 12px 30px;
            border-radius: 25px;
            text-decoration: none;
            margin-top: 20px;
            transition: all 0.3s;
            font-weight: 600;
            border: none;  /* í…Œë‘ë¦¬ ì œê±° */
            outline: none;  /* í¬ì»¤ìŠ¤ í…Œë‘ë¦¬ ì œê±° */
        }

        .back-btn:hover {
            background: #e8f4f8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .back-btn:focus {
            outline: none;  /* í´ë¦­ ì‹œ í…Œë‘ë¦¬ ì œê±° */
        }

        /* Day ì¹´ë“œ */
        .day-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f4f8;
        }

        .day-header h3 {
            color: #3498db;
            font-size: 1.5rem;
        }

        .day-cost {
            background: #e8f4f8;
            padding: 8px 15px;
            border-radius: 20px;
            color: #2c3e50;
            font-weight: 600;
        }

        .section-title {
            color: #3498db;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 25px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* êµí†µ */
        .attraction-item {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 3px solid #87CEEB;
        }

        /* ê´€ê´‘ì§€ */  
        .attraction-item {
            background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
            border-left: 3px solid #6CB4E4;
        }

        /* ì‹ì‚¬ */
        .meal-item {
            background: linear-gradient(135deg, #e8f4f8 0%, #d4ebf2 100%);
            border-left: 3px solid #A4D3E8;
        }

        .transport-item h4, .attraction-box h4, .meal-item h4, .accommodation-item h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .attraction-item p {
            margin: 10px 0;  /* ê°„ê²© ì¦ê°€ */
        }

        /* êµí†µ - ë¶€ë“œëŸ¬ìš´ íŒŒë‘ */
        .transport-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #5DADE2;
            box-shadow: 0 2px 8px rgba(93, 173, 226, 0.15);
        }

        /* ê´€ê´‘ì§€ - ë¶€ë“œëŸ¬ìš´ ì´ˆë¡ */
        .attraction-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #52BE80;
            box-shadow: 0 2px 8px rgba(82, 190, 128, 0.15);
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        /* ì‹ì‚¬ - ë¶€ë“œëŸ¬ìš´ ì£¼í™© */
        .meal-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #F39C12;
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.15);
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        /* ìˆ™ì†Œ - ë¶€ë“œëŸ¬ìš´ ë³´ë¼ */
        .accommodation-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #AF7AC5;
            box-shadow: 0 2px 8px rgba(175, 122, 197, 0.15);
        }

        /* ì œëª© */
        .transport-title { color: #5DADE2 !important; }
        .attraction-title { color: #52BE80 !important; }
        .meal-title { color: #F39C12 !important; }
        .accommodation-title { color: #AF7AC5 !important; }

        /* ê¸€ì”¨ ìƒ‰ - ë‹¤ì‹œ ê²€ì • */
        .transport-item h4, .attraction-box h4, .meal-item h4, .accommodation-item h4 {
            color: #2c3e50 !important;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .transport-item p, .attraction-box p, .meal-item p, .accommodation-item p {
            color: #555 !important;
            line-height: 1.6;
        }

        /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .place-image {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
            flex-shrink: 0;
        }

        .place-content {
            flex: 1;
        }

        .cost-badge {
            display: inline-block;
            margin-top: 12px;  /* ìœ„ìª½ ê°„ê²© ì¶”ê°€ */
            background: #e8f4f8;
            color: #3498db;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-navigation {
            position: fixed;
            bottom: 30px;
            left: 30%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .tab-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        @media (max-width: 1200px) {
            .result-container {
                grid-template-columns: 1fr;
            }
            
            .right-section {
                position: relative;
                height: 400px;
            }
            
            .tab-navigation {
                left: 50%;
            }
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCN8bgvjB0DvLgVvpk3GuNhvM_4auVgqH8"></script>
</head>
<body>
    <div class="result-container">
        <div class="left-section">
            <div class="result-header">
                <h1>âœˆï¸ AI Travel Planner</h1>
                <p style="margin-top: 10px;">{{ origin }} â†’ {{ destination }}</p>
                <p style="margin-top: 5px;">{{ departure_date }} ~ {{ return_date }} ({{ days }}ì¼)</p>
                <a href="/" class="back-btn">â† ìƒˆë¡œìš´ ê³„íš ë§Œë“¤ê¸°</a>
            </div>

            {# ğŸ”¥ AI Travel Planner ìƒë‹¨ ë°•ìŠ¤ ë°”ë¡œ ì•„ë˜ - ì˜ˆì‚° ìš”ì•½ ì¹´ë“œ #}
            {% if budget_summary %}
            <div class="summary-cards" style="margin: 20px 0 24px;">
            <div class="summary-card">
                <div class="card-icon">ğŸ’°</div>
                <div class="card-content">
                    <h4>ì´ ì˜ˆìƒ ì—¬í–‰ ë¹„ìš© (í•­ê³µ + ìˆ™ì†Œ ê¸°ì¤€)</h4>
                    <div class="price-big">{{ "{:,}".format(budget_summary.flight_total + budget_summary.hotel_total_krw) }}ì›</div>
                    <div class="label">
                        í•­ê³µ {{ "{:,}".format(budget_summary.flight_total) }}ì› Â· 
                        ìˆ™ì†Œ {{ "{:,}".format(budget_summary.hotel_total_krw) }}ì›
                        <br>
                        <span style="font-size: 12px; color: #7f8c8d;">
                        â€» ì‹ë¹„Â·ê´€ê´‘ì§€ ì…ì¥ë£ŒÂ·í•­ê³µê¶Œ ì œì™¸ í˜„ì§€ êµí†µë¹„ëŠ” ì˜ˆì‚° ê²€ì¦ì—ì„œ ì œì™¸ë˜ë©°,
                        í™”ë©´ì— í‘œì‹œë˜ëŠ” ê¸ˆì•¡ì€ ì°¸ê³ ìš© ì¶”ì •ì¹˜ì…ë‹ˆë‹¤.
                    </span>
                </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-content">
                <h4>ì˜ˆì‚° ëŒ€ë¹„</h4>
                <div class="value">
                    {% if budget_summary.is_over %}
                    ë¶€ì¡± {{ "{:,}".format(-budget_summary.diff) }}ì›
                    {% else %}
                    ì—¬ìœ  {{ "{:,}".format(budget_summary.diff) }}ì›
                    {% endif %}
                </div>
                <div class="label">
                    ì‚¬ìš©ì ì˜ˆì‚°: {{ "{:,}".format(budget_summary.user_budget) }}ì›
                </div>
                </div>
            </div>
            </div>
            {% endif %}

            {% if error %}
            <div style="background: white; padding: 40px; border-radius: 15px; text-align: center;">
                <h2 style="color: #e74c3c;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h2>
                <p>{{ error }}</p>
            </div>
            {% else %}

            {% if weather_info and weather_info.forecast %}
            <div class="weather-places-wrapper">

                <!-- ğŸŒ¤ ì™¼ìª½: ë‚ ì”¨ ì¹´ë“œ -->
                <div class="weather-card">
                    <h2 class="section-title-inline">ğŸŒ¤ ì—¬í–‰ì§€ ë‚ ì”¨</h2>

                    {% if weather_info.note %}
                    <p class="weather-note">
                        âš ï¸ {{ weather_info.note }}
                    </p>
                    {% endif %}

                    <div class="weather-details">
                        {% for w in weather_info.forecast %}
                        <div class="weather-row">
                            <div>
                                <strong>{{ w.date }}</strong><br>
                                <span>{{ w.description }}</span>
                            </div>
                            <div style="text-align:right;">
                                <span>í‰ê·  {{ w.temp_avg }}Â°C</span><br>
                                <span>{{ w.temp_min }}Â°C ~ {{ w.temp_max }}Â°C</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- ğŸ¯ ì˜¤ë¥¸ìª½: ì¶”ì²œ ê´€ê´‘ì§€ ë¦¬ìŠ¤íŠ¸ (ë³€ìˆ˜ëª…ì€ ë„ˆ ì½”ë“œì— ë§ê²Œ ìˆ˜ì •í•´) -->
                {% if result and result.places %}
                <div class="places-card">
                    <h2 class="section-title-inline">ğŸ¯ ì¶”ì²œ ê´€ê´‘ì§€</h2>
                    <div class="places-list">
                        {% for place in result.places %}
                        <div class="place-item">
                            <div class="place-header">
                                <strong>{{ place.name }}</strong>
                                {% if place.rating %}
                                <span class="place-rating">â˜… {{ place.rating }}</span>
                                {% endif %}
                            </div>
                            <p class="place-address">
                                {{ place.address }}
                            </p>
                            {% if place.map_url %}
                            <a href="{{ place.map_url }}" target="_blank" class="place-link">
                                êµ¬ê¸€ ì§€ë„ì—ì„œ ë³´ê¸°
                            </a>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>
            {% endif %}

            <h2 style="color: #2c3e50; margin-bottom: 20px; background: white; padding: 20px; border-radius: 10px;">ğŸ—“ï¸ ìƒì„¸ ì—¬í–‰ ì¼ì •</h2>

            {% for day in result.final_plan.itinerary %}
            <div class="day-card">
                <div class="day-header">
                    <h3>Day {{ loop.index }} ({{ day.date }})</h3>
                </div>

                {% if day.transportation %}
                <div class="section-title transport-title">ğŸš— êµí†µ</div>
                <div class="transport-item">
                    <h4>{{ day.transportation.type }}</h4>
                    <p>{{ day.transportation.details }}</p>

                    {# âœˆï¸ ë¹„í–‰ê¸°ì¸ ê²½ìš° í•­ê³µê¶Œ ë§í¬ í‘œì‹œ (Google Flights ê²€ìƒ‰) #}
                    {% if 'ë¹„í–‰ê¸°' in day.transportation.type
                          and result.flights_data
                          and result.flights_data.success
                          and result.flights_data.flights %}
                        {% set top_flight = result.flights_data.flights[0] %}
                        {% if top_flight.booking_url %}
                        <a href="{{ top_flight.booking_url }}"
                           target="_blank"
                           style="display:inline-block;margin-top:8px;font-size:13px;color:#3498db;">
                            ğŸ”— í•­ê³µê¶Œ ìƒì„¸ë³´ê¸° / ì˜ˆì•½í•˜ëŸ¬ ê°€ê¸°
                        </a>
                        {% endif %}
                    {% endif %}
                </div>
                {% endif %}

                {% if day.attractions %}
                <div class="section-title attraction-title">ğŸ¯ ê´€ê´‘ì§€</div>
                {% for attraction in day.attractions %}
                <div class="attraction-box">
                    <div class="place-content">
                        <h4>{{ attraction.name }}</h4>
                        <p>{{ attraction.description }}</p>
                    </div>
                    {% if attraction.photo_url %}
                    <img src="{{ attraction.photo_url }}" class="place-image" alt="{{ attraction.name }}">
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}

                {% if day.meals %}
                <div class="section-title meal-title">ğŸ½ï¸ ì‹ì‚¬</div>
                {% for meal in day.meals %}
                <div class="meal-item">
                    <div class="place-content">
                        <h4>{{ meal.type }}</h4>
                        <p>{{ meal.suggestion }}</p>
                        <!-- ğŸ”— êµ¬ê¸€ ì§€ë„ ê²€ìƒ‰ ë§í¬ (ì‹ë‹¹ ì´ë¦„/ì„¤ëª…ì„ ê·¸ëŒ€ë¡œ ê²€ìƒ‰) -->
                        <a href="https://www.google.com/maps/search/?api=1&query={{ meal.suggestion | replace(' ', '+') }}"
                        target="_blank"
                        style="display:inline-block;margin-top:8px;font-size:13px;color:#3498db;">
                            ğŸ”— êµ¬ê¸€ ì§€ë„ì—ì„œ ì‹ë‹¹ ìœ„ì¹˜ ë³´ê¸°
                        </a>
                    </div>
                    {% if meal.photo_url %}
                    <img src="{{ meal.photo_url }}" class="place-image" alt="{{ meal.suggestion }}">
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}

                {% if day.accommodation and day.accommodation.name != 'N/A' %}
                                    <div class="section-title accommodation-title">ğŸ¨ ìˆ™ì†Œ</div>
                                    <div class="accommodation-item">
                                    <h4>{{ day.accommodation.name }}</h4>
                                    <p>{{ day.accommodation.address }}</p>

                                    {# ìˆ™ì†Œ ìƒì„¸/ì˜ˆì•½ ë§í¬ - app.pyì—ì„œ ë„£ì–´ì¤€ booking_url ì‚¬ìš© #}
                                    {% if day.accommodation.booking_url %}
                                    <a href="{{ day.accommodation.booking_url }}"
                                    target="_blank"
                                    style="display:inline-block;margin-top:8px;font-size:13px;color:#3498db;">
                                        ğŸ”— í˜¸í…” ìƒì„¸ë³´ê¸° / ì˜ˆì•½í•˜ëŸ¬ ê°€ê¸°
                                    </a>
                                    {% endif %}
                                </div>
                {% endif %}
            </div>
            {% endfor %}

            {% endif %}
        </div>

        <div class="right-section">
            <div class="map-container">
                <div id="map"></div>
                <div class="map-legend">
                    {% if days %}
                        {% for i in range(1, days + 1) %}
                        <div class="legend-item">
                            <span class="marker-icon day{{ i }}">{{ i }}</span>
                            <span>{{ i }}ì¼ì°¨</span>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="tab-navigation">
        <button class="tab-btn" onclick="location.href='/info'">
            ğŸ“Š ì¶”ê°€ ì •ë³´ ë³´ê¸°
        </button>
    </div>

    <script>
    function initMap() {
        {% if result and result.places_json %}
            const placesData = {{ result.places_json | safe }};
            const center = placesData.length > 0 ? 
                { lat: placesData[0].lat, lng: placesData[0].lng } : 
                { lat: 37.5665, lng: 126.9780 };
        {% else %}
            const placesData = [];
            const center = { lat: 37.5665, lng: 126.9780 };
        {% endif %}
        
        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: center
        });
        
        placesData.forEach((place) => {
            new google.maps.Marker({
                position: { lat: place.lat, lng: place.lng },
                map: map,
                label: {
                    text: place.day.toString(),
                    color: 'white',
                    fontWeight: 'bold'
                },
                title: place.name,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 15,
                    fillColor: place.day === 1 ? '#e74c3c' : place.day === 2 ? '#3498db' : '#2ecc71',
                    fillOpacity: 1,
                    strokeColor: 'white',
                    strokeWeight: 2
                }
            });
        });
    }
    
    if (window.google && window.google.maps) {
        window.onload = initMap;
    }
    </script>
</body>
</html>